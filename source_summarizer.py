from openai import OpenAI
import os
from dotenv import load_dotenv

load_dotenv()

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def summarize_source(source_name, messages):
    combined_list = []

    for m in messages[:100]:
        text = m["text"]
        link = m.get("link")

        if link:
            combined_list.append(f"{text}\n(ì¶œì²˜: {link})")
        else:
            combined_list.append(text)

    combined = "\n\n".join(combined_list)

    prompt = f"""
    ì•„ë˜ëŠ” í…”ë ˆê·¸ë¨ ì±„ë„ '{source_name}'ì˜ ìµœê·¼ 24ì‹œê°„ ë©”ì‹œì§€ë‹¤.

    ì´ ì±„ë„ì´ ì˜¤ëŠ˜ ë‹¤ë£¬ ë‚´ìš©ì„ í•˜ë‚˜ì˜ ë¶„ì„ ë¦¬í¬íŠ¸ í˜•íƒœë¡œ ì‘ì„±í•˜ë¼.

    êµ¬ì„±:
    1. ğŸ“¡ ì±„ë„ëª…
    2. ì˜¤ëŠ˜ í•µì‹¬ ì£¼ì œ 3~5ê°œ (ê° ì£¼ì œëŠ” ì§§ì€ ì†Œì œëª© + ì„¤ëª…)
    3. ì „ë°˜ì ì¸ í•µì‹¬ íë¦„ ìš”ì•½

    ì¡°ê±´:
    - 800~1400ì ë¶„ëŸ‰
    - HTML í˜•ì‹
    - ì´ëª¨ì§€ ì ì ˆíˆ ì‚¬ìš©
    - ë‰´ìŠ¤ ë‚˜ì—´ ê¸ˆì§€
    - ì±„ë„ ë‚´ ë…¼ì˜ íë¦„ ì¤‘ì‹¬ìœ¼ë¡œ ì¬êµ¬ì„±
    - ì–´ë ¤ìš´ ê²½ì œ, ê¸°ìˆ ìš©ì–´ëŠ” ì‰½ê²Œ í’€ì–´ ì„¤ëª…
    - ì°¸ê³ í•œ ë§í¬ë„ í•˜ë‹¨ì— ì²¨ë¶€(ì°¸ê³  ë§í¬ëŠ” ë°˜ë“œì‹œ "ì›ë¬¸ ì¶œì²˜ ë§í¬" ì„¹ì…˜ì— ì œê³µëœ URLë§Œ ì‚¬ìš©í•˜ë¼.ë©”ì‹œì§€ ë³¸ë¬¸ì— í¬í•¨ëœ URLì€ ì ˆëŒ€ ì°¸ê³  ë§í¬ë¡œ í¬í•¨í•˜ì§€ ë§ˆë¼.ìƒˆë¡œìš´ URLì„ ìƒì„±í•˜ì§€ ë§ˆë¼.)

    ì•„ë˜ëŠ” í…”ë ˆê·¸ë¨ ì±„ë„ì˜ ìµœê·¼ 24ì‹œê°„ ë©”ì‹œì§€ë‹¤.

    âš ï¸ ì ˆëŒ€ HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆë¼.
    âš ï¸ <html>, <body>, <ul>, <li>, <p> ë“± ì–´ë–¤ íƒœê·¸ë„ ì“°ì§€ ë§ˆë¼.
    âš ï¸ Markdownë„ ì“°ì§€ ë§ˆë¼.
    âš ï¸ êµµê²Œ í‘œì‹œë„ í•˜ì§€ ë§ˆë¼.
    âš ï¸ ì˜¤ì§ ìˆœìˆ˜ í…ìŠ¤íŠ¸ë§Œ ì‚¬ìš©í•˜ë¼.
    ëŒ€ì‹  ë¬¸ë‹¨êµ¬ë¶„ ë° ë¬¸ë‹¨ê³¼ ë¬¸ë‹¨ì‚¬ì´ í•œì¤„ ë„ìš°ê¸°ë¥¼ í†µí•´ ê¸€ì˜ ê°€ë…ì„±ì„ ë†’ì—¬ë¼

    ë©”ì‹œì§€:
    {combined}
    """

    response = client.responses.create(
        model="gpt-5-mini",
        input=prompt,
    )

    return response.output_text